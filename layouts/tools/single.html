{{ define "main" }}
{{ $tool := index .Site.Data.tools .File.BaseFileName }}
{{ if not $tool }}
  <p>Tool not found.</p>
  {{ return }}
{{ end }}
{{ $score := index (index (index .Site.Data "generated" | default dict) "scores" | default dict) $tool.id }}

{{/* Build logo map: tool id -> logo URL */}}
{{ $logos := dict }}
{{ range resources.Match "tools/*" }}
  {{ $logos = merge $logos (dict (path.BaseName .Name) .RelPermalink) }}
{{ end }}
{{ $toolLogo := index $logos $tool.id }}

<article class="page-content">
  {{/* Title block (hero) */}}
  <header class="tool-detail-hero">
    <div class="tool-detail-hero-content">
      <h1 class="page-title">{{ $tool.name }}</h1>
      {{ with $score }}
      {{ $range := strings.TrimSpace (partial "score-range.html" .sovereignty_score) }}
      <a href="{{ "/sovereignty-score/" | relURL }}" class="score-badge score-badge-hero score-badge-range-{{ $range }}{{ if eq .score_confidence "low" }} score-confidence-low{{ end }}" title="{{ i18n "label_sovereignty_score" }}: {{ .sovereignty_score }}/10 ({{ .score_confidence }} confidence)">
        <span class="score-badge-value">{{ .sovereignty_score }}</span>
        <span class="score-badge-label">{{ i18n "label_sovereignty_score" }}</span>
      </a>
      {{ end }}
      <p class="tool-card-description">{{ $tool.description }}</p>
      <a href="{{ $tool.website }}" class="button" target="_blank" rel="noopener">{{ i18n "label_website" }}</a>
    </div>
    {{ with $toolLogo }}
    <img src="{{ . }}" alt="" class="tool-logo">
    {{ end }}
  </header>

  {{/* Two columns: main + sidebar */}}
  <div class="tool-detail-grid">
    <div class="tool-detail-main">
      <section>
        <h2 class="section-title">{{ i18n "label_about" }}</h2>
        <p>{{ $tool.description }}</p>
      </section>

      {{ if $tool.alternatives_to }}
      <section>
        <h2 class="section-title">{{ i18n "label_alternatives_to" }}</h2>
        <ul>
          {{ range $tool.alternatives_to }}
          <li>{{ . }}</li>
          {{ end }}
        </ul>
      </section>
      {{ end }}

      <section>
        <h2 class="section-title">{{ i18n "label_links" }}</h2>
        <a href="{{ $tool.website }}" target="_blank" rel="noopener" class="link">{{ i18n "label_website" }}</a>
      </section>
    </div>

    {{ partial "sovereignty-checklist.html" (dict "tool" $tool "score" $score) }}
  </div>
</article>
{{ end }}
